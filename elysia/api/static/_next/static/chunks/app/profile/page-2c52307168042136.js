(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{54509:function(e,t,s){Promise.resolve().then(s.bind(s,63253))},65023:function(e,t,s){"use strict";s.d(t,{T8:function(){return i},Zq:function(){return l},h5:function(){return a},ho:function(){return r},sd:function(){return n}}),s(40257);let r="",a="/static/",n=!0;function i(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?window.location.replace(e):window.location.assign(e)}let l=()=>{{let e="https:"===window.location.protocol?"wss:":"ws:",t=window.location.host;return"".concat(e,"//").concat(t,"/ws/")}}},63253:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var r=s(57437),a=s(53459),n=s(99049),i=s(35465),l=s(2265),o=s(78582),d=s(65023),c=s(99376),u=s(62869),m=s(26815),f=s(53647),x=s(33079),p=s(94508);let h=l.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(x.fC,{className:(0,p.cn)("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-secondary/30",s),...a,ref:t,children:(0,r.jsx)(x.bU,{className:(0,p.cn)("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})})});function g(){var e,t;let s=(0,o.e)(),x=(0,c.useRouter)(),[p,g]=(0,l.useState)(null),{profile:b,loading:j,error:v,refetch:w}=function(e){let[t,s]=(0,l.useState)(null),[r,a]=(0,l.useState)(!0),[n,i]=(0,l.useState)(null),d=(0,l.useMemo)(()=>(0,o.e)(),[]),c=(0,l.useCallback)(async()=>{if(!e){s(null),a(!1);return}a(!0),i(null);try{let{data:t,error:r}=await d.from("user_profiles").select("*").eq("id",e).maybeSingle();if(r)throw r;let a=t;if(!a){let{data:t,error:s}=await d.from("user_profiles").upsert({id:e,org_unit:null,app_role:"user",response_detail_level:"balanced",communication_tone:"professional",preferred_language:"it",response_focus:"technical",custom_instructions:"",custom_instructions_mode:"append"},{onConflict:"id"}).select("*").single();if(s)throw s;a=t}let n=null;if(a.org_unit){let{data:e,error:t}=await d.from("org_units").select("id, name, ai_identity_base, created_at").eq("id",a.org_unit).maybeSingle();if(t)throw t;n=null!=e?e:null}s({...a,org_units:n})}catch(e){i("object"==typeof e&&null!==e&&"message"in e&&"string"==typeof e.message?e.message:"Failed to load profile")}finally{a(!1)}},[d,e]);return(0,l.useEffect)(()=>{c()},[c]),{profile:t,loading:r,error:n,refetch:c}}(null==p?void 0:p.id),[y,N]=(0,l.useState)("balanced"),[_,k]=(0,l.useState)("professional"),[z,C]=(0,l.useState)("it"),[S,I]=(0,l.useState)("technical"),[Q,Z]=(0,l.useState)(""),[R,E]=(0,l.useState)("append"),[O,q]=(0,l.useState)(!1),[B,P]=(0,l.useState)(null),[T,F]=(0,l.useState)(!1),{instructions:V,loading:J}=function(e,t){let[s,r]=(0,l.useState)(null),[a,n]=(0,l.useState)(!1),[i,d]=(0,l.useState)(null),c=(0,l.useMemo)(()=>(0,o.e)(),[]),u=(0,l.useCallback)(async()=>{if(!e||!t){r(null),n(!1);return}n(!0),d(null);try{var s;let{data:a,error:n}=await c.from("role_standard_instructions").select("instructions").eq("department",e).eq("job_title",t).maybeSingle();if(n)throw n;r(null!==(s=null==a?void 0:a.instructions)&&void 0!==s?s:null)}catch(e){d("object"==typeof e&&null!==e&&"message"in e?e.message:"Failed to load standard instructions")}finally{n(!1)}},[c,e,t]);return(0,l.useEffect)(()=>{u()},[u]),{instructions:s,loading:a,error:i}}(null==b?void 0:b.department,null==b?void 0:b.job_title);(0,l.useEffect)(()=>{(async()=>{let{data:{user:e},error:t}=await s.auth.getUser();t||!e?(0,d.T8)("/login"):g(e)})()},[x,s.auth]),(0,l.useEffect)(()=>{b&&(N(b.response_detail_level),k(b.communication_tone),C(b.preferred_language),I(b.response_focus),Z(b.custom_instructions||""),E(b.custom_instructions_mode||"append"))},[b]);let U=async()=>{if(p){q(!0),P(null),F(!1);try{let{error:e}=await s.from("user_profiles").upsert({id:p.id,response_detail_level:y,communication_tone:_,preferred_language:z,response_focus:S,custom_instructions:Q,custom_instructions_mode:R,updated_at:new Date().toISOString()});if(e)throw e;F(!0),await w(),setTimeout(()=>F(!1),3e3)}catch(e){P(e instanceof Error?e.message:"Failed to save profile")}finally{q(!1)}}};return p?(0,r.jsxs)("div",{className:"flex flex-col items-center h-full w-full gap-6 p-6 overflow-hidden",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold font-heading text-primary",children:"Profilo Utente"}),(0,r.jsx)("div",{className:"flex-1 w-full max-w-4xl bg-background_alt rounded-xl border border-border p-8 shadow-sm overflow-y-auto",children:j?(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsx)(a.Z,{className:"w-8 h-8 animate-spin text-primary"})}):v?(0,r.jsx)("div",{className:"text-red-500 p-4 bg-red-500/10 rounded-lg",children:v}):(0,r.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"w-20 h-20 rounded-full bg-primary/10 flex items-center justify-center text-primary text-2xl font-bold border border-border",children:null===(e=p.email)||void 0===e?void 0:e.substring(0,2).toUpperCase()}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-foreground",children:(null===(t=p.user_metadata)||void 0===t?void 0:t.full_name)||"User"}),(0,r.jsx)("p",{className:"text-secondary",children:p.email})]})]}),(0,r.jsxs)(u.z,{onClick:()=>{x.push("/")},className:"flex items-center gap-2",children:[(0,r.jsx)(n.Z,{className:"w-4 h-4"}),"Torna alla Home"]})]}),(0,r.jsx)("div",{className:"h-px w-full bg-border"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Identit\xe0 Organizzativa"}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2 w-1/5",children:[(0,r.jsx)(m._,{className:"text-sm font-semibold text-secondary uppercase tracking-wider",children:"Department"}),(0,r.jsx)("div",{className:"p-3 rounded-lg bg-background border border-border text-sm text-secondary",children:(null==b?void 0:b.department)||(0,r.jsx)("span",{className:"italic text-secondary/50",children:"Non disponibile"})})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-2 flex-1",children:[(0,r.jsx)(m._,{className:"text-sm font-semibold text-secondary uppercase tracking-wider",children:"Job Title"}),(0,r.jsx)("div",{className:"p-3 rounded-lg bg-background border border-border text-sm text-secondary",children:(null==b?void 0:b.job_title)||(0,r.jsx)("span",{className:"italic text-secondary/50",children:"Non disponibile"})})]})]}),(0,r.jsx)("div",{className:"h-px w-full bg-border"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(m._,{className:"text-sm font-semibold text-secondary uppercase tracking-wider",children:"Livello di dettaglio"}),(0,r.jsxs)(f.Ph,{value:y,onValueChange:e=>N(e),children:[(0,r.jsx)(f.i4,{className:"w-full",children:(0,r.jsx)(f.ki,{})}),(0,r.jsxs)(f.Bw,{children:[(0,r.jsx)(f.Ql,{value:"executive_summary",children:"Sintesi esecutiva"}),(0,r.jsx)(f.Ql,{value:"balanced",children:"Bilanciato"}),(0,r.jsx)(f.Ql,{value:"operational_detail",children:"Dettaglio operativo"})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(m._,{className:"text-sm font-semibold text-secondary uppercase tracking-wider",children:"Tono"}),(0,r.jsxs)(f.Ph,{value:_,onValueChange:e=>k(e),children:[(0,r.jsx)(f.i4,{className:"w-full",children:(0,r.jsx)(f.ki,{})}),(0,r.jsxs)(f.Bw,{children:[(0,r.jsx)(f.Ql,{value:"formal",children:"Formale"}),(0,r.jsx)(f.Ql,{value:"professional",children:"Professionale"}),(0,r.jsx)(f.Ql,{value:"direct",children:"Diretto"})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(m._,{className:"text-sm font-semibold text-secondary uppercase tracking-wider",children:"Lingua preferita"}),(0,r.jsxs)(f.Ph,{value:z,onValueChange:e=>C(e),children:[(0,r.jsx)(f.i4,{className:"w-full",children:(0,r.jsx)(f.ki,{})}),(0,r.jsxs)(f.Bw,{children:[(0,r.jsx)(f.Ql,{value:"it",children:"Italiano"}),(0,r.jsx)(f.Ql,{value:"en",children:"English"})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(m._,{className:"text-sm font-semibold text-secondary uppercase tracking-wider",children:"Focus risposte"}),(0,r.jsxs)(f.Ph,{value:S,onValueChange:e=>I(e),children:[(0,r.jsx)(f.i4,{className:"w-full",children:(0,r.jsx)(f.ki,{})}),(0,r.jsxs)(f.Bw,{children:[(0,r.jsx)(f.Ql,{value:"normative",children:"Normativo/regolamentare"}),(0,r.jsx)(f.Ql,{value:"managerial",children:"Gestionale/organizzativo"}),(0,r.jsx)(f.Ql,{value:"technical",children:"Tecnico/specialistico"}),(0,r.jsx)(f.Ql,{value:"relational",children:"Comunicazione/relazionale"})]})]})]})]}),(0,r.jsx)("div",{className:"h-px w-full bg-border"}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(m._,{className:"text-sm font-semibold text-secondary uppercase tracking-wider",children:"Istruzioni standard"}),(0,r.jsx)("div",{className:"w-full min-h-[120px] p-4 rounded-lg bg-background border border-border text-sm text-secondary whitespace-pre-wrap",children:J?(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)(a.Z,{className:"w-4 h-4 animate-spin"}),"Caricamento..."]}):V||(0,r.jsx)("span",{className:"italic text-secondary/50",children:"Nessuna istruzione standard per il ruolo corrente"})})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(m._,{htmlFor:"custom-instructions",className:"text-sm font-semibold text-secondary uppercase tracking-wider",children:"Istruzioni personalizzate"}),(0,r.jsx)("textarea",{id:"custom-instructions",value:Q,onChange:e=>Z(e.target.value),placeholder:"Inserisci istruzioni personalizzate per l'AI...",className:"w-full min-h-[200px] p-4 rounded-lg bg-background border border-foreground_alt text-primary text-sm resize-y focus:outline-none focus:ring-1 focus:ring-ring focus:border-primary transition-colors font-mono"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(h,{id:"instructions-mode",checked:"override"===R,onCheckedChange:e=>E(e?"override":"append")}),(0,r.jsx)(m._,{htmlFor:"instructions-mode",className:"text-sm font-semibold text-secondary uppercase tracking-wider cursor-pointer",children:"Sovrascrivi istruzioni standard"}),(0,r.jsx)("span",{className:"text-sm text-primary",children:"override"===R?"Le istruzioni personalizzate sostituiscono quelle standard":"Le istruzioni personalizzate si aggiungono a quelle standard"})]}),(0,r.jsx)("div",{className:"h-px w-full bg-border"}),(0,r.jsxs)("div",{className:"flex justify-end items-center gap-4",children:[T&&(0,r.jsx)("span",{className:"text-green-500 text-sm",children:"Profilo salvato!"}),B&&(0,r.jsx)("span",{className:"text-red-500 text-sm",children:B}),(0,r.jsxs)(u.z,{variant:"outline",onClick:U,disabled:O,className:"flex items-center gap-2",children:[O?(0,r.jsx)(a.Z,{className:"w-4 h-4 animate-spin"}):(0,r.jsx)(i.Z,{className:"w-4 h-4"}),"Salva"]})]})]})})]}):null}h.displayName=x.fC.displayName},62869:function(e,t,s){"use strict";s.d(t,{d:function(){return o},z:function(){return d}});var r=s(57437),a=s(2265),n=s(37053),i=s(90535),l=s(94508);let o=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 active:scale-95 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-background_alt text-secondary hover:bg-foreground hover:text-primary",destructive:"bg-error/10 text-error hover:bg-error/20",accept:"bg-accent/10 text-accent hover:bg-accent/20",outline:"border border-input shadow-sm hover:bg-foreground_alt hover:text-primary",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-foreground_alt hover:text-primary border border-transparent",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-8 w-8"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,t)=>{let{className:s,variant:a,size:i,asChild:d=!1,...c}=e,u=d?n.g7:"button";return(0,r.jsx)(u,{className:(0,l.cn)(o({variant:a,size:i,className:s})),ref:t,...c})});d.displayName="Button"},26815:function(e,t,s){"use strict";s.d(t,{_:function(){return d}});var r=s(57437),a=s(2265),n=s(370),i=s(90535),l=s(94508);let o=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.f,{ref:t,className:(0,l.cn)(o(),s),...a})});d.displayName=n.f.displayName},53647:function(e,t,s){"use strict";s.d(t,{Bw:function(){return p},Ph:function(){return c},Ql:function(){return h},i4:function(){return m},ki:function(){return u}});var r=s(57437),a=s(2265),n=s(56502),i=s(3289),l=s(47969),o=s(59559),d=s(94508);let c=n.fC;n.ZA;let u=n.B4,m=a.forwardRef((e,t)=>{let{className:s,children:a,...l}=e;return(0,r.jsxs)(n.xz,{ref:t,className:(0,d.cn)("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-foreground_alt bg-background text-primary px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-secondary focus:outline-none focus:ring-1 focus:ring-ring focus:border-primary disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 hover:bg-foreground_alt hover:border-primary transition-colors",s),...l,children:[a,(0,r.jsx)(n.JO,{asChild:!0,children:(0,r.jsx)(i.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=n.xz.displayName;let f=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.u_,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,r.jsx)(l.Z,{className:"h-4 w-4"})})});f.displayName=n.u_.displayName;let x=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.$G,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})})});x.displayName=n.$G.displayName;let p=a.forwardRef((e,t)=>{let{className:s,children:a,position:i="popper",...l}=e;return(0,r.jsx)(n.h_,{children:(0,r.jsxs)(n.VY,{ref:t,className:(0,d.cn)("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border border-foreground_alt bg-background text-primary shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:i,...l,children:[(0,r.jsx)(f,{}),(0,r.jsx)(n.l_,{className:(0,d.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,r.jsx)(x,{})]})})});p.displayName=n.VY.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.__,{ref:t,className:(0,d.cn)("px-2 py-1.5 text-sm font-semibold text-primary",s),...a})}).displayName=n.__.displayName;let h=a.forwardRef((e,t)=>{let{className:s,children:a,...i}=e;return(0,r.jsxs)(n.ck,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm text-primary outline-none hover:bg-foreground_alt focus:bg-foreground data-[state=checked]:bg-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 transition-colors",s),...i,children:[(0,r.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(n.wU,{children:(0,r.jsx)(o.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(n.eT,{children:a})]})});h.displayName=n.ck.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-foreground_alt",s),...a})}).displayName=n.Z0.displayName},78582:function(e,t,s){"use strict";s.d(t,{e:function(){return a}});var r=s(11259);function a(){return(0,r.createBrowserClient)(function(){let e="/supabase";return e.startsWith("/")?"".concat(window.location.origin).concat(e):e}(),"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlzcyI6InN1cGFiYXNlIiwiaWF0IjoxNzcwODI0OTcwLCJleHAiOjE5Mjg1MDQ5NzB9.hbIOpqCgw-rro9kaZjEQ7T-xZ9qRYvXeS3PmMgq4smw",{cookieOptions:{name:"sb-athena-auth-token"}})}s(40257)},94508:function(e,t,s){"use strict";s.d(t,{cn:function(){return n}});var r=s(61994),a=s(53335);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.m6)((0,r.W)(t))}}},function(e){e.O(0,[972,531,363,241,971,117,744],function(){return e(e.s=54509)}),_N_E=e.O()}]);