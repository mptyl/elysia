(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{54509:function(e,s,t){Promise.resolve().then(t.bind(t,63253))},63253:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return h}});var a=t(57437),r=t(53459),n=t(99049),l=t(35465),i=t(2265),o=t(78582),d=t(99376),c=t(62869),u=t(26815),m=t(53647),f=t(33079),x=t(94508);let p=i.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(f.fC,{className:(0,x.cn)("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-secondary/30",t),...r,ref:s,children:(0,a.jsx)(f.bU,{className:(0,x.cn)("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})})});function h(){var e,s;let t=(0,o.e)(),f=(0,d.useRouter)(),[x,h]=(0,i.useState)(null),{profile:g,loading:b,error:j,refetch:v}=function(e){let[s,t]=(0,i.useState)(null),[a,r]=(0,i.useState)(!0),[n,l]=(0,i.useState)(null),d=(0,i.useMemo)(()=>(0,o.e)(),[]),c=(0,i.useCallback)(async()=>{if(!e){t(null),r(!1);return}r(!0),l(null);try{let{data:s,error:a}=await d.from("user_profiles").select("*").eq("id",e).maybeSingle();if(a)throw a;let r=s;if(!r){let{data:s,error:t}=await d.from("user_profiles").upsert({id:e,org_unit:null,app_role:"user",response_detail_level:"balanced",communication_tone:"professional",preferred_language:"it",response_focus:"technical",custom_instructions:"",custom_instructions_mode:"append"},{onConflict:"id"}).select("*").single();if(t)throw t;r=s}let n=null;if(r.org_unit){let{data:e,error:s}=await d.from("org_units").select("id, name, ai_identity_base, created_at").eq("id",r.org_unit).maybeSingle();if(s)throw s;n=null!=e?e:null}t({...r,org_units:n})}catch(e){l("object"==typeof e&&null!==e&&"message"in e&&"string"==typeof e.message?e.message:"Failed to load profile")}finally{r(!1)}},[d,e]);return(0,i.useEffect)(()=>{c()},[c]),{profile:s,loading:a,error:n,refetch:c}}(null==x?void 0:x.id),[y,N]=(0,i.useState)("balanced"),[w,_]=(0,i.useState)("professional"),[k,z]=(0,i.useState)("it"),[C,S]=(0,i.useState)("technical"),[I,Q]=(0,i.useState)(""),[Z,R]=(0,i.useState)("append"),[E,O]=(0,i.useState)(!1),[B,P]=(0,i.useState)(null),[q,F]=(0,i.useState)(!1),{instructions:T,loading:V}=function(e,s){let[t,a]=(0,i.useState)(null),[r,n]=(0,i.useState)(!1),[l,d]=(0,i.useState)(null),c=(0,i.useMemo)(()=>(0,o.e)(),[]),u=(0,i.useCallback)(async()=>{if(!e||!s){a(null),n(!1);return}n(!0),d(null);try{var t;let{data:r,error:n}=await c.from("role_standard_instructions").select("instructions").eq("department",e).eq("job_title",s).maybeSingle();if(n)throw n;a(null!==(t=null==r?void 0:r.instructions)&&void 0!==t?t:null)}catch(e){d("object"==typeof e&&null!==e&&"message"in e?e.message:"Failed to load standard instructions")}finally{n(!1)}},[c,e,s]);return(0,i.useEffect)(()=>{u()},[u]),{instructions:t,loading:r,error:l}}(null==g?void 0:g.department,null==g?void 0:g.job_title);(0,i.useEffect)(()=>{(async()=>{let{data:{user:e},error:s}=await t.auth.getUser();s||!e?f.push("/login"):h(e)})()},[f,t.auth]),(0,i.useEffect)(()=>{g&&(N(g.response_detail_level),_(g.communication_tone),z(g.preferred_language),S(g.response_focus),Q(g.custom_instructions||""),R(g.custom_instructions_mode||"append"))},[g]);let J=async()=>{if(x){O(!0),P(null),F(!1);try{let{error:e}=await t.from("user_profiles").upsert({id:x.id,response_detail_level:y,communication_tone:w,preferred_language:k,response_focus:C,custom_instructions:I,custom_instructions_mode:Z,updated_at:new Date().toISOString()});if(e)throw e;F(!0),await v(),setTimeout(()=>F(!1),3e3)}catch(e){P(e instanceof Error?e.message:"Failed to save profile")}finally{O(!1)}}};return x?(0,a.jsxs)("div",{className:"flex flex-col items-center h-full w-full gap-6 p-6 overflow-hidden",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold font-heading text-primary",children:"Profilo Utente"}),(0,a.jsx)("div",{className:"flex-1 w-full max-w-4xl bg-background_alt rounded-xl border border-border p-8 shadow-sm overflow-y-auto",children:b?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)(r.Z,{className:"w-8 h-8 animate-spin text-primary"})}):j?(0,a.jsx)("div",{className:"text-red-500 p-4 bg-red-500/10 rounded-lg",children:j}):(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-20 h-20 rounded-full bg-primary/10 flex items-center justify-center text-primary text-2xl font-bold border border-border",children:null===(e=x.email)||void 0===e?void 0:e.substring(0,2).toUpperCase()}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-foreground",children:(null===(s=x.user_metadata)||void 0===s?void 0:s.full_name)||"User"}),(0,a.jsx)("p",{className:"text-secondary",children:x.email})]})]}),(0,a.jsxs)(c.z,{onClick:()=>{f.push("/")},className:"flex items-center gap-2",children:[(0,a.jsx)(n.Z,{className:"w-4 h-4"}),"Torna alla Home"]})]}),(0,a.jsx)("div",{className:"h-px w-full bg-border"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Identit\xe0 Organizzativa"}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2 w-1/5",children:[(0,a.jsx)(u._,{className:"text-sm font-semibold text-secondary uppercase tracking-wider",children:"Department"}),(0,a.jsx)("div",{className:"p-3 rounded-lg bg-background border border-border text-sm text-secondary",children:(null==g?void 0:g.department)||(0,a.jsx)("span",{className:"italic text-secondary/50",children:"Non disponibile"})})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 flex-1",children:[(0,a.jsx)(u._,{className:"text-sm font-semibold text-secondary uppercase tracking-wider",children:"Job Title"}),(0,a.jsx)("div",{className:"p-3 rounded-lg bg-background border border-border text-sm text-secondary",children:(null==g?void 0:g.job_title)||(0,a.jsx)("span",{className:"italic text-secondary/50",children:"Non disponibile"})})]})]}),(0,a.jsx)("div",{className:"h-px w-full bg-border"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(u._,{className:"text-sm font-semibold text-secondary uppercase tracking-wider",children:"Livello di dettaglio"}),(0,a.jsxs)(m.Ph,{value:y,onValueChange:e=>N(e),children:[(0,a.jsx)(m.i4,{className:"w-full",children:(0,a.jsx)(m.ki,{})}),(0,a.jsxs)(m.Bw,{children:[(0,a.jsx)(m.Ql,{value:"executive_summary",children:"Sintesi esecutiva"}),(0,a.jsx)(m.Ql,{value:"balanced",children:"Bilanciato"}),(0,a.jsx)(m.Ql,{value:"operational_detail",children:"Dettaglio operativo"})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(u._,{className:"text-sm font-semibold text-secondary uppercase tracking-wider",children:"Tono"}),(0,a.jsxs)(m.Ph,{value:w,onValueChange:e=>_(e),children:[(0,a.jsx)(m.i4,{className:"w-full",children:(0,a.jsx)(m.ki,{})}),(0,a.jsxs)(m.Bw,{children:[(0,a.jsx)(m.Ql,{value:"formal",children:"Formale"}),(0,a.jsx)(m.Ql,{value:"professional",children:"Professionale"}),(0,a.jsx)(m.Ql,{value:"direct",children:"Diretto"})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(u._,{className:"text-sm font-semibold text-secondary uppercase tracking-wider",children:"Lingua preferita"}),(0,a.jsxs)(m.Ph,{value:k,onValueChange:e=>z(e),children:[(0,a.jsx)(m.i4,{className:"w-full",children:(0,a.jsx)(m.ki,{})}),(0,a.jsxs)(m.Bw,{children:[(0,a.jsx)(m.Ql,{value:"it",children:"Italiano"}),(0,a.jsx)(m.Ql,{value:"en",children:"English"})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(u._,{className:"text-sm font-semibold text-secondary uppercase tracking-wider",children:"Focus risposte"}),(0,a.jsxs)(m.Ph,{value:C,onValueChange:e=>S(e),children:[(0,a.jsx)(m.i4,{className:"w-full",children:(0,a.jsx)(m.ki,{})}),(0,a.jsxs)(m.Bw,{children:[(0,a.jsx)(m.Ql,{value:"normative",children:"Normativo/regolamentare"}),(0,a.jsx)(m.Ql,{value:"managerial",children:"Gestionale/organizzativo"}),(0,a.jsx)(m.Ql,{value:"technical",children:"Tecnico/specialistico"}),(0,a.jsx)(m.Ql,{value:"relational",children:"Comunicazione/relazionale"})]})]})]})]}),(0,a.jsx)("div",{className:"h-px w-full bg-border"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(u._,{className:"text-sm font-semibold text-secondary uppercase tracking-wider",children:"Istruzioni standard"}),(0,a.jsx)("div",{className:"w-full min-h-[120px] p-4 rounded-lg bg-background border border-border text-sm text-secondary whitespace-pre-wrap",children:V?(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)(r.Z,{className:"w-4 h-4 animate-spin"}),"Caricamento..."]}):T||(0,a.jsx)("span",{className:"italic text-secondary/50",children:"Nessuna istruzione standard per il ruolo corrente"})})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(u._,{htmlFor:"custom-instructions",className:"text-sm font-semibold text-secondary uppercase tracking-wider",children:"Istruzioni personalizzate"}),(0,a.jsx)("textarea",{id:"custom-instructions",value:I,onChange:e=>Q(e.target.value),placeholder:"Inserisci istruzioni personalizzate per l'AI...",className:"w-full min-h-[200px] p-4 rounded-lg bg-background border border-foreground_alt text-primary text-sm resize-y focus:outline-none focus:ring-1 focus:ring-ring focus:border-primary transition-colors font-mono"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(p,{id:"instructions-mode",checked:"override"===Z,onCheckedChange:e=>R(e?"override":"append")}),(0,a.jsx)(u._,{htmlFor:"instructions-mode",className:"text-sm font-semibold text-secondary uppercase tracking-wider cursor-pointer",children:"Sovrascrivi istruzioni standard"}),(0,a.jsx)("span",{className:"text-sm text-primary",children:"override"===Z?"Le istruzioni personalizzate sostituiscono quelle standard":"Le istruzioni personalizzate si aggiungono a quelle standard"})]}),(0,a.jsx)("div",{className:"h-px w-full bg-border"}),(0,a.jsxs)("div",{className:"flex justify-end items-center gap-4",children:[q&&(0,a.jsx)("span",{className:"text-green-500 text-sm",children:"Profilo salvato!"}),B&&(0,a.jsx)("span",{className:"text-red-500 text-sm",children:B}),(0,a.jsxs)(c.z,{variant:"outline",onClick:J,disabled:E,className:"flex items-center gap-2",children:[E?(0,a.jsx)(r.Z,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(l.Z,{className:"w-4 h-4"}),"Salva"]})]})]})})]}):null}p.displayName=f.fC.displayName},62869:function(e,s,t){"use strict";t.d(s,{d:function(){return o},z:function(){return d}});var a=t(57437),r=t(2265),n=t(37053),l=t(90535),i=t(94508);let o=(0,l.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 active:scale-95 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-background_alt text-secondary hover:bg-foreground hover:text-primary",destructive:"bg-error/10 text-error hover:bg-error/20",accept:"bg-accent/10 text-accent hover:bg-accent/20",outline:"border border-input shadow-sm hover:bg-foreground_alt hover:text-primary",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-foreground_alt hover:text-primary border border-transparent",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-8 w-8"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,s)=>{let{className:t,variant:r,size:l,asChild:d=!1,...c}=e,u=d?n.g7:"button";return(0,a.jsx)(u,{className:(0,i.cn)(o({variant:r,size:l,className:t})),ref:s,...c})});d.displayName="Button"},26815:function(e,s,t){"use strict";t.d(s,{_:function(){return d}});var a=t(57437),r=t(2265),n=t(370),l=t(90535),i=t(94508);let o=(0,l.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(n.f,{ref:s,className:(0,i.cn)(o(),t),...r})});d.displayName=n.f.displayName},53647:function(e,s,t){"use strict";t.d(s,{Bw:function(){return p},Ph:function(){return c},Ql:function(){return h},i4:function(){return m},ki:function(){return u}});var a=t(57437),r=t(2265),n=t(56502),l=t(3289),i=t(47969),o=t(59559),d=t(94508);let c=n.fC;n.ZA;let u=n.B4,m=r.forwardRef((e,s)=>{let{className:t,children:r,...i}=e;return(0,a.jsxs)(n.xz,{ref:s,className:(0,d.cn)("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-foreground_alt bg-background text-primary px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-secondary focus:outline-none focus:ring-1 focus:ring-ring focus:border-primary disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 hover:bg-foreground_alt hover:border-primary transition-colors",t),...i,children:[r,(0,a.jsx)(n.JO,{asChild:!0,children:(0,a.jsx)(l.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=n.xz.displayName;let f=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(n.u_,{ref:s,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(i.Z,{className:"h-4 w-4"})})});f.displayName=n.u_.displayName;let x=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(n.$G,{ref:s,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(l.Z,{className:"h-4 w-4"})})});x.displayName=n.$G.displayName;let p=r.forwardRef((e,s)=>{let{className:t,children:r,position:l="popper",...i}=e;return(0,a.jsx)(n.h_,{children:(0,a.jsxs)(n.VY,{ref:s,className:(0,d.cn)("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border border-foreground_alt bg-background text-primary shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:l,...i,children:[(0,a.jsx)(f,{}),(0,a.jsx)(n.l_,{className:(0,d.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(x,{})]})})});p.displayName=n.VY.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(n.__,{ref:s,className:(0,d.cn)("px-2 py-1.5 text-sm font-semibold text-primary",t),...r})}).displayName=n.__.displayName;let h=r.forwardRef((e,s)=>{let{className:t,children:r,...l}=e;return(0,a.jsxs)(n.ck,{ref:s,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm text-primary outline-none hover:bg-foreground_alt focus:bg-foreground data-[state=checked]:bg-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 transition-colors",t),...l,children:[(0,a.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(n.wU,{children:(0,a.jsx)(o.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(n.eT,{children:r})]})});h.displayName=n.ck.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(n.Z0,{ref:s,className:(0,d.cn)("-mx-1 my-1 h-px bg-foreground_alt",t),...r})}).displayName=n.Z0.displayName},78582:function(e,s,t){"use strict";t.d(s,{e:function(){return r}});var a=t(11259);function r(){return(0,a.createBrowserClient)(function(){let e="/supabase";return e.startsWith("/")?"".concat(window.location.origin).concat(e):e}(),"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlzcyI6InN1cGFiYXNlIiwiaWF0IjoxNzcwODI0OTcwLCJleHAiOjE5Mjg1MDQ5NzB9.hbIOpqCgw-rro9kaZjEQ7T-xZ9qRYvXeS3PmMgq4smw",{cookieOptions:{name:"sb-athena-auth-token"}})}t(40257)},94508:function(e,s,t){"use strict";t.d(s,{cn:function(){return n}});var a=t(61994),r=t(53335);function n(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,r.m6)((0,a.W)(s))}}},function(e){e.O(0,[972,531,363,241,971,117,744],function(){return e(e.s=54509)}),_N_E=e.O()}]);