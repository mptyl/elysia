"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2823],{4474:(e,t,r)=>{r.d(t,{$:()=>c,r:()=>l});var o=r(95155),n=r(12115),a=r(42442),s=r(18460),i=r(91337);let l=(0,s.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 active:scale-95 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-background_alt text-secondary hover:bg-foreground hover:text-primary",destructive:"bg-error/10 text-error hover:bg-error/20",accept:"bg-accent/10 text-accent hover:bg-accent/20",outline:"border border-input shadow-sm hover:bg-foreground_alt hover:text-primary",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-foreground_alt hover:text-primary border border-transparent",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-8 w-8"}},defaultVariants:{variant:"default",size:"default"}}),c=n.forwardRef(({className:e,variant:t,size:r,asChild:n=!1,...s},c)=>{let d=n?a.DX:"button";return(0,o.jsx)(d,{className:(0,i.cn)(l({variant:t,size:r,className:e})),ref:c,...s})});c.displayName="Button"},23511:(e,t,r)=>{r.d(t,{E:()=>a});var o=r(95155),n=r(91337);function a({className:e,...t}){return(0,o.jsx)("div",{className:(0,n.cn)("animate-pulse rounded-md bg-primary/10",e),...t})}},26939:(e,t,r)=>{r.d(t,{Hc:()=>o,VJ:()=>s,aI:()=>a,sS:()=>n,sb:()=>i}),r(41463);let o="",n="/static/",a=!0;function s(e,t=!1){t?window.location.replace(e):window.location.assign(e)}let i=()=>{{let e="https:"===window.location.protocol?"wss:":"ws:",t=window.location.host;return`${e}//${t}/ws/`}}},28176:(e,t,r)=>{r.d(t,{C:()=>d,CollectionProvider:()=>u});var o=r(95155),n=r(12115),a=r(26939);async function s(e){performance.now();try{if(!e)return[];let t=await fetch(`${a.Hc}/collections/${e}/list`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)return console.error(`Get Collections error! status: ${t.status} ${t.statusText}`),[];return(await t.json()).collections}catch(e){return console.error("Get Collections error:",e),[]}finally{}}var i=r(89892);async function l(e,t){performance.now();try{let r=await fetch(`${a.Hc}/collections/${e}/metadata/${t}`,{method:"DELETE"});if(!r.ok)return console.error(`Deleting collection metadata error! status: ${r.status} ${r.statusText}`),{error:r.statusText};return{error:""}}catch(e){return console.error(e instanceof Error?e.message:String(e)),{error:"Error deleting collection metadata"}}finally{}}var c=r(97950);let d=(0,n.createContext)({collections:[],fetchCollections:()=>{},loadingCollections:!1,deleteCollection:()=>{},getRandomPrompts:()=>[]}),u=({children:e})=>{let{id:t,fetchCollectionFlag:r,initialized:a}=(0,n.useContext)(i.I),{showErrorToast:u,showSuccessToast:f}=(0,n.useContext)(c.$),[g,m]=(0,n.useState)([]),[p,h]=(0,n.useState)(!1),y=(0,n.useRef)(t),v=(0,n.useRef)(!1);(0,n.useEffect)(()=>{!v.current&&t&&a&&(v.current=!0,y.current=t,b())},[t,a]),(0,n.useEffect)(()=>{b()},[r]);let b=async()=>{if(!y.current)return;m([]),h(!0);let e=await s(y.current);m(e),h(!1),f(`${e.length} Collections Loaded`)},w=async e=>{if(!y.current)return;let t=await l(y.current,e);t.error?u("Failed to Remove Analysis",t.error):(f("Analysis Removed",`Analysis for "${e}" has been removed successfully.`),b())};return(0,o.jsx)(d.Provider,{value:{collections:g,fetchCollections:b,loadingCollections:p,deleteCollection:w,getRandomPrompts:(e=4)=>g.reduce((e,t)=>e.concat(t.prompts||[]),[]).sort(()=>.5-Math.random()).slice(0,e)},children:e})}},36992:(e,t,r)=>{r.d(t,{RouterProvider:()=>l,z:()=>i});var o=r(95155),n=r(12115),a=r(73321),s=r(97950);let i=(0,n.createContext)({currentPage:"chat",changePage:()=>{},prefillPrompt:"",setPrefillPrompt:()=>{},autoSendPrefill:!1}),l=({children:e})=>{let[t,r]=(0,n.useState)("chat"),[l,c]=(0,n.useState)(""),[d,u]=(0,n.useState)(!1),{showConfirmModal:f}=(0,n.useContext)(s.$),g=(0,a.useSearchParams)(),m=(e,t={},r=!1)=>{let o;if(r)o={page:e,...t};else{let r={};g.forEach((e,t)=>{r[t]=e}),o={...r,page:e,...t}}let n=`/?${new URLSearchParams(o).toString()}`;r?window.history.replaceState(null,"",n):window.history.pushState(null,"",n)};return(0,n.useEffect)(()=>{if("/login"===window.location.pathname)return;let e=g.get("page");if(!e){let e={};g.forEach((t,r)=>{e[r]=t});let t=`/?${new URLSearchParams({page:"chat",...e}).toString()}`;window.history.replaceState(null,"",t),r("chat");return}let t=["chat","data","collection","settings","eval","feedback","elysia","display","reportistica","prompt-enhancer"].includes(e)?e:"chat";if(e!==t){let e={};g.forEach((t,r)=>{"page"!==r&&(e[r]=t)});let t=`/?${new URLSearchParams({page:"chat",...e}).toString()}`;window.history.replaceState(null,"",t)}r(t)},[g]),(0,o.jsx)(i.Provider,{value:{currentPage:t,changePage:(e,t={},r=!1,o=!1)=>{o?f("Unsaved Changes","You have unsaved changes. Are you sure you want to leave this page? You will lose your changes.",()=>m(e,t,r)):m(e,t,r)},prefillPrompt:l,setPrefillPrompt:(e,t=!1)=>{c(e),u(t)},autoSendPrefill:d},children:e})}},39658:(e,t,r)=>{r.d(t,{p:()=>s});var o=r(95155),n=r(12115),a=r(91337);let s=n.forwardRef(({className:e,type:t,...r},n)=>(0,o.jsx)("input",{type:t,className:(0,a.cn)("flex h-9 w-full rounded-md border border-foreground_alt bg-transparent px-3 py-1 text-sm md:text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,...r}));s.displayName="Input"},43447:(e,t,r)=>{r.d(t,{Hr:()=>g,Ht:()=>y,I:()=>f,SQ:()=>m,_2:()=>p,hO:()=>h,lp:()=>v,mB:()=>b,rI:()=>d,ty:()=>u});var o=r(95155),n=r(12115),a=r(61108),s=r(28528),i=r(66336),l=r(99304),c=r(91337);let d=a.bL,u=a.l9,f=a.YJ;a.ZL,a.Pb;let g=a.z6;n.forwardRef(({className:e,inset:t,children:r,...n},i)=>(0,o.jsxs)(a.ZP,{ref:i,className:(0,c.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-foreground data-[state=open]:bg-foreground_alt [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",e),...n,children:[r,(0,o.jsx)(s.A,{className:"ml-auto"})]})).displayName=a.ZP.displayName,n.forwardRef(({className:e,...t},r)=>(0,o.jsx)(a.G5,{ref:r,className:(0,c.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t})).displayName=a.G5.displayName;let m=n.forwardRef(({className:e,sideOffset:t=4,...r},n)=>(0,o.jsx)(a.ZL,{children:(0,o.jsx)(a.UC,{ref:n,sideOffset:t,className:(0,c.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border border-foreground_alt bg-background_alt p-1 text-primary","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));m.displayName=a.UC.displayName;let p=n.forwardRef(({className:e,inset:t,...r},n)=>(0,o.jsx)(a.q7,{ref:n,className:(0,c.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-foreground_alt focus:text-primary data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",t&&"pl-8",e),...r}));p.displayName=a.q7.displayName;let h=n.forwardRef(({className:e,children:t,checked:r,...n},s)=>(0,o.jsxs)(a.H_,{ref:s,className:(0,c.cn)("relative flex cursor-pointer select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-background_alt focus:text-primary data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:r,...n,children:[(0,o.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,o.jsx)(a.VF,{children:(0,o.jsx)(i.A,{className:"h-4 w-4"})})}),t]}));h.displayName=a.H_.displayName;let y=n.forwardRef(({className:e,children:t,...r},n)=>(0,o.jsxs)(a.hN,{ref:n,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-foreground_alt focus:text-primary data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[(0,o.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,o.jsx)(a.VF,{children:(0,o.jsx)(l.A,{className:"h-2 w-2 fill-current"})})}),t]}));y.displayName=a.hN.displayName;let v=n.forwardRef(({className:e,inset:t,...r},n)=>(0,o.jsx)(a.JU,{ref:n,className:(0,c.cn)("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...r}));v.displayName=a.JU.displayName;let b=n.forwardRef(({className:e,...t},r)=>(0,o.jsx)(a.wv,{ref:r,className:(0,c.cn)("-mx-1 my-1 h-px bg-secondary",e),...t}));b.displayName=a.wv.displayName},45726:(e,t,r)=>{r.d(t,{U:()=>n});var o=r(57716);function n(){let e;return(0,o.createBrowserClient)((e="/supabase").startsWith("/")?`${window.location.origin}${e}`:e,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlzcyI6InN1cGFiYXNlIiwiaWF0IjoxNzcwODI0OTcwLCJleHAiOjE5Mjg1MDQ5NzB9.hbIOpqCgw-rro9kaZjEQ7T-xZ9qRYvXeS3PmMgq4smw",{cookieOptions:{name:"sb-10-auth-token"}})}r(41463)},51087:(e,t,r)=>{r.d(t,{Qg:()=>g,Sb:()=>p,US:()=>d,aD:()=>h,eC:()=>m,tE:()=>c,y8:()=>f});var o=r(95155),n=r(12115),a=r(86183),s=r(18460),i=r(4268),l=r(91337);let c=a.Kq,d=n.forwardRef(({className:e,...t},r)=>(0,o.jsx)(a.LM,{ref:r,className:(0,l.cn)("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 gap-1 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));d.displayName=a.LM.displayName;let u=(0,s.F)("group pointer-events-auto relative flex w-full items-center justify-between space-x-2 overflow-hidden rounded-md border p-4 pr-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border border-secondary bg-background_alt text-primary",destructive:"group border-error bg-error/10 text-error",warning:"warning group border-warning bg-warning text-primary"}},defaultVariants:{variant:"default"}}),f=n.forwardRef(({className:e,variant:t,progress:r,...n},s)=>(0,o.jsxs)(a.bL,{ref:s,className:(0,l.cn)(u({variant:t}),"relative",e),...n,children:[void 0!==r&&(0,o.jsx)("div",{className:"absolute left-0 bottom-0 right-0 h-1 w-full bg-secondary",children:(0,o.jsx)("div",{className:"h-full bg-primary transition-all duration-150 ease-linear",style:{width:`${Math.max(0,Math.min(100,r))}%`}})}),n.children]}));f.displayName=a.bL.displayName;let g=n.forwardRef(({className:e,...t},r)=>(0,o.jsx)(a.rc,{ref:r,className:(0,l.cn)("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...t}));g.displayName=a.rc.displayName;let m=n.forwardRef(({className:e,...t},r)=>(0,o.jsx)(a.bm,{ref:r,className:(0,l.cn)("absolute right-1 top-1 rounded-md p-1 text-primary opacity-0 transition-opacity hover:text-secondary focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:(0,o.jsx)(i.A,{className:"h-4 w-4"})}));m.displayName=a.bm.displayName;let p=n.forwardRef(({className:e,...t},r)=>(0,o.jsx)(a.hE,{ref:r,className:(0,l.cn)("text-sm font-semibold [&+div]:text-xs",e),...t}));p.displayName=a.hE.displayName;let h=n.forwardRef(({className:e,...t},r)=>(0,o.jsx)(a.VY,{ref:r,className:(0,l.cn)("text-sm opacity-90",e),...t}));h.displayName=a.VY.displayName},61991:(e,t,r)=>{r.d(t,{w:()=>i});var o=r(95155),n=r(12115),a=r(89803),s=r(91337);let i=n.forwardRef(({className:e,orientation:t="horizontal",decorative:r=!0,...n},i)=>(0,o.jsx)(a.b,{ref:i,decorative:r,orientation:t,className:(0,s.cn)("shrink-0 bg-foreground_alt","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",e),...n}));i.displayName=a.b.displayName},66986:(e,t,r)=>{r.d(t,{ProcessingProvider:()=>c,p:()=>l});var o=r(95155),n=r(26939),a=r(12115),s=r(28176),i=r(97950);let l=(0,a.createContext)({triggerAnalysis:()=>{}}),c=({children:e})=>{let{fetchCollections:t}=(0,a.useContext)(s.C),{showErrorToast:r,finishProcessingSocket:c,updateProcessingSocket:d,analyzeCollection:u}=(0,a.useContext)(i.$),[f,g]=(0,a.useState)(),[m,p]=(0,a.useState)(!1),h=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{p(!0)},[]),(0,a.useEffect)(()=>{if(h.current)return;h.current=!0;let e=new WebSocket((0,n.sb)()+"process_collection");g(e),e.onopen=()=>{},e.onerror=e=>{g(void 0)},e.onclose=()=>{g(void 0)},e.onmessage=e=>{let o=JSON.parse(e.data);if(!o.type||"heartbeat"!==o.type){if(!o.type||!o.collection_name){console.warn("Received invalid message from processing socket: "+e.data),"error"===o.type&&(r("Error analyzing "+o.collection_name+"...",o.error||"Unknown error"),c(o.collection_name,o.error||""));return}o.error?c(o.collection_name,o.error||""):"update"===o.type?d(o.collection_name,o.progress,o.message):("completed"===o.type?c(o.collection_name,""):c(o.collection_name,o.error||""),t())}}},[m]),(0,a.useEffect)(()=>{if(!h.current)return;let e=setInterval(()=>{f?.readyState!==WebSocket.CLOSED&&f||(h.current=!1,console.log("Processing Socket not online, reconnecting..."),p(e=>!e))},5e3);return()=>clearInterval(e)},[f]),(0,o.jsx)(l.Provider,{value:{triggerAnalysis:(e,t)=>{f?u(e,t,f):r("Error analyzing "+e.name+"...","Connection to Athena lost (Socket: "+f+") (ID: "+t+")")}},children:e})}},67347:(e,t,r)=>{r.d(t,{dj:()=>u});var o=r(12115);let n=0,a=new Map,s=e=>{if(a.has(e))return;let t=setTimeout(()=>{a.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);a.set(e,t)},i=[],l={toasts:[]};function c(e){l=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1e3)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?s(r):e.toasts.forEach(e=>{s(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(l,e),i.forEach(e=>{e(l)})}function d({...e}){let t=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>c({type:"DISMISS_TOAST",toastId:t});return c({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||r()}}}),{id:t,dismiss:r,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function u(){let[e,t]=o.useState(l);return o.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},73033:(e,t,r)=>{r.d(t,{F:()=>n});var o=r(26939);async function n(e,t,r){performance.now();try{if(!e)return{error:"No user id"};let n=await fetch(`${o.Hc}/feedback/remove`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e,conversation_id:t,query_id:r})});if(!n.ok)return console.error(`Delete Feedback error! status: ${n.status} ${n.statusText}`),{error:"Failed to delete feedback"};return await n.json()}catch(e){return console.error("Delete Feedback error:",e),{error:"Failed to delete feedback"}}finally{}}},74350:(e,t,r)=>{r.d(t,{Cf:()=>u,Es:()=>g,L3:()=>m,c7:()=>f,lG:()=>l,rr:()=>p});var o=r(95155),n=r(12115),a=r(29483),s=r(4268),i=r(91337);let l=a.bL;a.l9;let c=a.ZL;a.bm;let d=n.forwardRef(({className:e,...t},r)=>(0,o.jsx)(a.hJ,{ref:r,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));d.displayName=a.hJ.displayName;let u=n.forwardRef(({className:e,children:t,...r},n)=>(0,o.jsxs)(c,{children:[(0,o.jsx)(d,{}),(0,o.jsxs)(a.UC,{ref:n,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-2xl translate-x-[-50%] translate-y-[-50%] gap-4 border border-foreground bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,(0,o.jsxs)(a.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,o.jsx)(s.A,{className:"h-4 w-4"}),(0,o.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));u.displayName=a.UC.displayName;let f=({className:e,...t})=>(0,o.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});f.displayName="DialogHeader";let g=({className:e,...t})=>(0,o.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});g.displayName="DialogFooter";let m=n.forwardRef(({className:e,...t},r)=>(0,o.jsx)(a.hE,{ref:r,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",e),...t}));m.displayName=a.hE.displayName;let p=n.forwardRef(({className:e,...t},r)=>(0,o.jsx)(a.VY,{ref:r,className:(0,i.cn)("text-sm text-muted-foreground",e),...t}));p.displayName=a.VY.displayName},74834:(e,t,r)=>{r.d(t,{r:()=>b,ConversationProvider:()=>w});var o=r(95155),n=r(12115),a=r(98825);let s={id:(0,a.A)(),name:"New Conversation",error:!1,tree_updates:[],timestamp:new Date,enabled_collections:{},tree:[],base_tree:null,current:"",queries:{},initialized:!1};var i=r(28176),l=r(89892),c=r(26939);async function d(e){performance.now();try{let t=await fetch(`${c.Hc}/db/${e}/saved_trees`,{method:"GET"});if(!t.ok)return console.error(`Error fetching saved trees! status: ${t.status} ${t.statusText}`),{trees:{},error:"Error fetching saved conversations"};return await t.json()}catch(e){return console.error(e instanceof Error?e.message:String(e)),{trees:{},error:"Error fetching saved conversations"}}finally{}}async function u(e,t){performance.now();try{let r=await fetch(`${c.Hc}/db/${e}/load_tree/${t}`,{method:"GET"});if(!r.ok)return console.error(`Error fetching saved conversation ${t}! status: ${r.status} ${r.statusText}`),{rebuild:[],error:`Error fetching saved conversation ${t}`};return await r.json()}catch(e){return console.error(e instanceof Error?e.message:String(e)),{rebuild:[],error:`Error fetching saved conversation ${t}`}}finally{}}async function f(e,t,r=!1){performance.now();try{let o=await fetch(`${c.Hc}/init/tree/${e}/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({low_memory:r})});if(!o.ok)return console.error(`Initializing tree failed! status: ${o.status}, error: ${o.statusText}`),{conversation_id:t,error:"Failed to initialize tree",tree:null};let n=await o.json();if(null==n.tree)return{conversation_id:t,error:"Failed to initialize tree",tree:null};let a=e=>{e.choosen=!1,e.blocked=!1,e.options&&Object.values(e.options).forEach(e=>{a(e)})};return a(n.tree),n.tree.choosen=!0,n}catch(e){return console.error(e instanceof Error?e.message:String(e)),{conversation_id:t,error:"Failed to initialize tree",tree:null}}finally{}}async function g(e,t,r){performance.now();try{let o=await fetch(`${c.Hc}/util/follow_up_suggestions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e,conversation_id:t,auth_key:r})});if(!o.ok)return console.error(`Error fetching follow_up_suggestions! status: ${o.status} ${o.statusText}`),{suggestions:[],error:`Error fetching follow_up_suggestions! status: ${o.status} ${o.statusText}`};return await o.json()}catch(e){return console.error(e instanceof Error?e.message:String(e)),{suggestions:[],error:"Error fetching follow_up_suggestions!}"}}finally{}}async function m(e,t){performance.now();try{let r=await fetch(`${c.Hc}/db/${e}/delete_tree/${t}`,{method:"DELETE",body:JSON.stringify({})});if(!r.ok)return console.error(`Error deleting conversation ${t}! status: ${r.status} ${r.statusText}`),{error:`Error deleting conversation ${t}`};return await r.json()}catch(e){return console.error(e instanceof Error?e.message:String(e)),{error:`Error deleting conversation ${t}`}}finally{}}async function p(e,t,r,o){performance.now();try{if(!e)return{error:"No user id"};let n=await fetch(`${c.Hc}/feedback/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e,conversation_id:t,query_id:r,feedback:o})});if(!n.ok)return console.error(`Add Feedback error! status: ${n.status} ${n.statusText}`),{error:"Failed to add feedback"};return await n.json()}catch(e){return console.error("Add Feedback error:",e),{error:"Failed to add feedback"}}finally{}}var h=r(73033),y=r(36992),v=r(73321);let b=(0,n.createContext)({conversations:[],setConversations:()=>{},currentConversation:null,setCurrentConversation:()=>{},creatingNewConversation:!1,setCreatingNewConversation:()=>{},loadingConversations:!1,loadingConversation:!1,startNewConversation:()=>{},conversationPreviews:{},addConversation:()=>Promise.resolve(null),removeConversation:()=>{},selectConversation:()=>{},setConversationStatus:()=>{},setAllConversationStatuses:()=>{},addMessageToConversation:()=>{},initializeEnabledCollections:()=>{},handleConversationError:()=>{},toggleCollectionEnabled:()=>{},handleWebsocketMessage:()=>{},updateTree:()=>{},addTreeToConversation:()=>{},changeBaseToQuery:()=>{},addQueryToConversation:()=>{},finishQuery:()=>{},updateNERForQuery:()=>{},updateFeedbackForQuery:()=>{},triggerAllCollections:()=>{},handleAllConversationsError:()=>{},addSuggestionToConversation:()=>{},getAllEnabledCollections:()=>[],loadConversationsFromDB:()=>{}}),w=({children:e})=>{let{collections:t}=(0,n.useContext)(i.C),{id:r,enableRateLimitDialog:c,initialized:w,fetchConversationFlag:x}=(0,n.useContext)(l.I),{changePage:_,currentPage:C}=(0,n.useContext)(y.z),S=(0,v.useSearchParams)(),N=(0,v.usePathname)(),$=(0,n.useRef)(!1),[j,T]=(0,n.useState)([]),[k,E]=(0,n.useState)({}),[P,z]=(0,n.useState)(null),[O,D]=(0,n.useState)(!1),[A,q]=(0,n.useState)(!1),[I,R]=(0,n.useState)(!1),F=async(e,t)=>""===e?null:await f(e,t),L=async()=>{if(!r)return;D(!0);let e=await d(r||""),t=!1;for(let[r,o]of Object.entries(e.trees))o&&o.title&&o.last_update_time&&(E(e=>({...e,[r]:o})),t=!0);D(!1),t||A||await er()},M=async(e,o,n)=>{if(R(!0),j.find(t=>t.id===e))z(e);else{let a=await u(r||"",e);q(!0);let s=await F(r||"",e);if(null!=s&&null!=t&&null!=s.tree){let r=a.rebuild.filter(e=>e&&"user_prompt"===e.type),i=a.rebuild.filter(e=>e&&"completed"===e.type),l={};for(let e of i){let t=e.payload;t&&"boolean"==typeof t.rag_enabled&&(l[e.query_id]=t.rag_enabled)}let c={};for(let t of r){let r=Y(e,t.payload.prompt,t.query_id,j);r.rag_enabled=l[t.query_id]??!0,c[t.query_id]=r}let d={enabled_collections:t.reduce((e,t)=>({...e,[t.name]:!0}),{}),id:e,name:o,tree_updates:[],tree:s.tree?[...r.map(e=>({...s.tree,name:e.payload.prompt})),s.tree]:[],base_tree:s.tree||null,queries:c,current:"",initialized:!0,error:!1,timestamp:n};for(let t of(r.forEach(t=>{V(e,t.payload.prompt)}),T(e=>[...e,d]),a.rebuild))et(t)}q(!1)}R(!1)},U=async e=>{if(!e?.trim()||A)return null;let r=(0,a.A)();q(!0);let[o]=await Promise.all([F(e,r)]);if(null===o||null===t||null===o.tree)return q(!1),null;let n={...s,id:r,timestamp:new Date,tree:[o.tree],base_tree:o.tree,enabled_collections:t.reduce((e,t)=>({...e,[t.name]:!0}),{})};return T([...j||[],n]),z(r),q(!1),E(e=>({...e,[r]:{title:n.name,last_update_time:new Date().toISOString()}})),"chat"===C&&_("chat",{conversation:r},!0),n},H=(e,t)=>{T(r=>r.map(r=>r.id===t?{...r,current:e}:r))},J=async(e,t)=>{T(r=>r.map(r=>r.id===t?{...r,name:e}:r)),E(r=>({...r,[t]:{title:e,last_update_time:new Date().toISOString()}}))},G=async(e,t,r)=>{if(!r)return;let o=await g(r,e,"");W([{type:"suggestion",id:(0,a.A)(),conversation_id:e,query_id:t,user_id:r,payload:{error:"",suggestions:o.suggestions}}],e,t)},W=(e,t,r)=>{T(o=>o.map(o=>o.id===t?o.queries[r]?{...o,initialized:!0,queries:{...o.queries,[r]:{...o.queries[r],messages:[...o.queries[r].messages,...e]}}}:(console.warn(`Query ${r} not found in conversation ${t} ${JSON.stringify(Object.keys(o.queries))}`),o):o))},Q=e=>{let t=e.payload,r=(e,o,n)=>{if(!e)return null;if(e.id!==n.node||e.blocked)if(!e.options||!(Object.keys(e.options).length>0))return e;else{let n=Object.entries(e.options).reduce((e,[n,a])=>{let s=r(a,o,t);return s&&(e[n]=s),e},{});return{...e,options:n,blocked:!0}}{let t=Object.entries(e.options).reduce((e,[t,r])=>(t===n.decision?e[t]={...r,choosen:!0,reasoning:n.reasoning,options:n.reset?o?{base:o}:{}:r.options||{}}:e[t]=r,e),{});return{...e,options:t,blocked:!0}}};T(o=>o.map(o=>{if(o.id===e.conversation_id){let e=r(o.tree[t.tree_index],o.base_tree,t),n=[...o.tree||[]];return e&&(n[t.tree_index]=e),{...o,tree:n,tree_updates:[...o.tree_updates,t]}}return o}))},V=(e,t)=>{let r=j.find(t=>t.id===e)?.tree?.length||1;T(o=>o.map(o=>{if(o.id===e){let e=[...o.tree];return e[r-1]&&(e[r-1]={...e[r-1],name:t}),{...o,tree:e}}return o}))},Y=(e,t,o,n,s=[],i=!0)=>{let l={type:"User",id:(0,a.A)(),query_id:o,conversation_id:e,user_id:r||"",payload:{type:"text",metadata:{},code:{language:"",title:"",text:""},objects:[t]}};return{id:o,query:t,finished:!1,query_start:new Date,query_end:null,feedback:null,NER:null,index:n.find(t=>t.id===e)?.queries[o]?.index||0,messages:[l,...s],rag_enabled:i}},Z=(e,t,r)=>{T(o=>o.map(o=>o.id===e&&o.queries[t]?{...o,queries:{...o.queries,[t]:{...o.queries[t],finished:!0,query_end:new Date,...void 0!==r?{rag_enabled:r}:{}}}}:o))},B=(e,t,r)=>{T(o=>o.map(o=>o.id===e&&o.queries[t]?{...o,queries:{...o.queries,[t]:{...o.queries[t],NER:r}}}:o))},X=async(e,t,o)=>{let n=j.find(t=>t.id===e);n&&!n.error&&(n.queries[t].feedback===o?(await (0,h.F)(r||"",e,t),T(r=>r.map(r=>r.id===e&&r.queries[t]?{...r,queries:{...r.queries,[t]:{...r.queries[t],feedback:null}}}:r))):(K(r||"",e,t,o),T(r=>r.map(r=>r.id===e&&r.queries[t]?{...r,queries:{...r.queries,[t]:{...r.queries[t],feedback:o}}}:r))))},K=async(e,t,r,o)=>await p(e,t,r,o),ee=e=>{T(t=>t.map(t=>t.id===e?{...t,error:!0}:t))},et=e=>{if(e)if("status"===e.type)H(e.payload.text,e.conversation_id);else if("title"===e.type)J(e.payload.title,e.conversation_id);else if("ner"===e.type){let t=e.payload;B(e.conversation_id,e.query_id,t)}else if("completed"===e.type){let t=e.payload;H("",e.conversation_id),Z(e.conversation_id,e.query_id,t.rag_enabled),G(e.conversation_id,e.query_id,e.user_id)}else"tree_update"===e.type?Q(e):(["error","tree_timeout_error","rate_limit_error","authentication_error"].includes(e.type)&&(ee(e.conversation_id),Z(e.conversation_id,e.query_id),H("",e.conversation_id)),"rate_limit_error"===e.type&&c(),W([e],e.conversation_id,e.query_id))},er=async()=>{if(r){let e=await U(r);e&&z(e.id)}};return(0,n.useEffect)(()=>{t&&T(e=>e.map(e=>e.enabled_collections&&0!==Object.keys(e.enabled_collections).length?e:{...e,enabled_collections:t.reduce((e,t)=>({...e,[t.name]:!0}),{})}))},[t]),(0,n.useEffect)(()=>{r&&!$.current&&w&&($.current=!0,L())},[r,w]),(0,n.useEffect)(()=>{L()},[x]),(0,n.useEffect)(()=>{let e=S.get("page");if("/"===N&&("chat"===e||null===e)&&$.current&&r&&Object.keys(k).length>0){let e=S.get("conversation");if(e){if(e===P)return;if(!k[e])return void _("chat",{conversation:Object.entries(k).sort(([,e],[,t])=>new Date(t.last_update_time).getTime()-new Date(e.last_update_time).getTime())[0][0]},!0);let t=j.find(t=>t.id===e),r=k[e].title;t||M(e,r,new Date(k[e].last_update_time)),z(e)}else{let e=Object.entries(k).sort(([,e],[,t])=>new Date(t.last_update_time).getTime()-new Date(e.last_update_time).getTime())[0][0];e!==P&&_("chat",{conversation:e},!0)}}},[S,N,k,r,P]),(0,o.jsx)(b.Provider,{value:{setConversations:T,setCurrentConversation:z,conversations:j,currentConversation:P,addConversation:U,removeConversation:e=>{P===e&&z(null),T([]),E({}),m(r||"",e),L()},selectConversation:e=>{_("chat",{conversation:e},!0)},setConversationStatus:H,setAllConversationStatuses:e=>{T(t=>t.map(t=>({...t,current:e})))},addMessageToConversation:W,initializeEnabledCollections:(e,t)=>{T(r=>r.map(r=>r.id===t?{...r,enabled_collections:e}:r))},toggleCollectionEnabled:(e,t)=>{T(r=>r.map(r=>{if(r.id===t){let t={...r.enabled_collections,[e]:!r.enabled_collections[e]};return{...r,enabled_collections:t}}return r}))},updateTree:Q,addTreeToConversation:e=>{T(t=>t.map(t=>t.id===e&&t.base_tree?{...t,tree:[...t.tree,{...t.base_tree}]}:t))},startNewConversation:er,changeBaseToQuery:V,addQueryToConversation:(e,t,r,o=!0)=>{T(n=>n.map(a=>{let s=Y(e,t,r,n,[],o);return a.id===e?{...a,queries:{...a.queries,[r]:s}}:a}))},creatingNewConversation:A,conversationPreviews:k,loadingConversations:O,setCreatingNewConversation:q,finishQuery:Z,updateNERForQuery:B,updateFeedbackForQuery:X,triggerAllCollections:(e,t)=>{T(r=>r.map(r=>{if(r.id===e){let e=Object.keys(r.enabled_collections).reduce((e,r)=>(e[r]=t,e),{});return{...r,enabled_collections:e}}return r}))},handleConversationError:ee,handleAllConversationsError:()=>{T(e=>e.map(e=>({...e,error:!0})))},addSuggestionToConversation:G,getAllEnabledCollections:()=>j.reduce((e,t)=>[...e,...Object.entries(t.enabled_collections||{}).filter(([e,t])=>!0===t).map(([e,t])=>e)],[]),loadConversationsFromDB:L,handleWebsocketMessage:et,loadingConversation:I},children:e})}},84437:(e,t,r)=>{r.d(t,{S:()=>l});var o=r(95155),n=r(12115),a=r(47279),s=r(66336),i=r(91337);let l=n.forwardRef(({className:e,...t},r)=>(0,o.jsx)(a.bL,{ref:r,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-secondary focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-foreground_alt  data-[state=checked]:text-primary",e),...t,children:(0,o.jsx)(a.C1,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,o.jsx)(s.A,{className:"h-4 w-4"})})}));l.displayName=a.bL.displayName},89892:(e,t,r)=>{r.d(t,{I:()=>h,SessionProvider:()=>y});var o=r(95155),n=r(12115),a=r(73321),s=r(26939);async function i(e){performance.now();try{let t=await fetch(`${s.Hc}/init/user/${e}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok)return console.error(`Initializing user failed! status: ${t.status}, error: ${t.statusText}`),{error:"Failed to initialize user",user_exists:!1,config:null,frontend_config:null,correct_settings:{base_model:!1,base_provider:!1,complex_model:!1,complex_provider:!1,wcd_url:!1,wcd_api_key:!1}};return await t.json()}catch(e){return console.error(e instanceof Error?e.message:String(e)),{error:"Failed to initialize user",user_exists:!1,config:null,frontend_config:null,correct_settings:{base_model:!1,base_provider:!1,complex_model:!1,complex_provider:!1,wcd_url:!1,wcd_api_key:!1}}}finally{}}async function l(e,t,r,o=!0){performance.now();try{if(!e||!t)return{error:"No user id or backend config",config:null,frontend_config:null,warnings:[]};let n=await fetch(`${s.Hc}/user/config/${e}/${t.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.name,config:t,frontend_config:r,default:o})});if(!n.ok)return console.error(`Saving Config error! status: ${n.status} ${n.statusText}`),{error:`Saving Config error! status: ${n.status} ${n.statusText}`,config:null,frontend_config:null,warnings:[]};return await n.json()}catch(e){return console.error("Saving Config error:",e),{error:e,config:null,frontend_config:null,warnings:[]}}finally{}}async function c(e){performance.now();try{if(!e)return{error:"No user id",configs:[],warnings:[]};let t=await fetch(`${s.Hc}/user/config/${e}/list`,{method:"GET",headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"}});if(!t.ok)return console.error(`Get Config List error! status: ${t.status} ${t.statusText}`),{error:`Get Config List error! status: ${t.status} ${t.statusText}`,configs:[],warnings:[]};return await t.json()}catch(e){return console.error("Get Config List error:",e),{error:e,configs:[],warnings:[]}}finally{}}async function d(e){performance.now();try{if(!e)return{error:"No user id",config:null,frontend_config:null,warnings:[]};let t=await fetch(`${s.Hc}/user/config/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)return console.error(`Get Config error! status: ${t.status} ${t.statusText}`),{error:`Get Config error! status: ${t.status} ${t.statusText}`,config:null,frontend_config:null,warnings:[]};return await t.json()}catch(e){return console.error("Get Config error:",e),{error:e,config:null,frontend_config:null,warnings:[]}}finally{}}async function u(e){performance.now();try{if(!e)return{error:"No user id",config:null,frontend_config:null,warnings:[]};let t=await fetch(`${s.Hc}/user/config/${e}/new`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok)return console.error(`Creating new Config error! status: ${t.status} ${t.statusText}`),{error:`Creating new Config error! status: ${t.status} ${t.statusText}`,config:null,frontend_config:null,warnings:[]};let r=await t.json();return{error:"",config:r.config,frontend_config:r.frontend_config,warnings:r.warnings}}catch(e){return console.error("Creating new Config error:",e),{error:e,config:null,frontend_config:null,warnings:[]}}finally{}}async function f(e,t){performance.now();try{if(!e||!t)return{error:"No user id or config id",config:null,frontend_config:null,warnings:[]};let r=await fetch(`${s.Hc}/user/config/${e}/${t}/load`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)return console.error(`Loading Config error! status: ${r.status} ${r.statusText}`),{error:`Loading Config error! status: ${r.status} ${r.statusText}`,config:null,frontend_config:null,warnings:[]};return await r.json()}catch(e){return console.error("Loading Config error:",e),{error:e,config:null,frontend_config:null,warnings:[]}}finally{}}async function g(e,t){performance.now();try{if(!e||!t)return{error:"No user id or config id"};let r=await fetch(`${s.Hc}/user/config/${e}/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!r.ok)return console.error(`Deleting Config error! status: ${r.status} ${r.statusText}`),{error:`Deleting Config error! status: ${r.status} ${r.statusText}`};return await r.json()}catch(e){return console.error("Deleting Config error:",e),{error:e}}finally{}}var m=r(97950),p=r(45726);let h=(0,n.createContext)({mode:"home",id:"",showRateLimitDialog:!1,enableRateLimitDialog:()=>{},userConfig:null,savingConfig:!1,fetchCurrentConfig:()=>{},configIDs:[],updateConfig:async()=>!1,handleCreateConfig:()=>{},getConfigIDs:()=>{},handleLoadConfig:()=>{},handleDeleteConfig:()=>{},loadingConfig:!1,loadingConfigs:!1,correctSettings:null,triggerFetchCollection:()=>{},fetchCollectionFlag:!1,initialized:!1,triggerFetchConversation:()=>{},fetchConversationFlag:!1,updateUnsavedChanges:()=>{},unsavedChanges:!1,initError:null}),y=({children:e})=>{let{showErrorToast:t,showSuccessToast:r,showWarningToast:s}=(0,n.useContext)(m.$),[y,v]=(0,n.useState)("home"),b=(0,a.usePathname)(),[w,x]=(0,n.useState)(!1),{id:_}=function(){let[e,t]=(0,n.useState)(null),[r,o]=(0,n.useState)(null),[a,s]=(0,n.useState)(!0),i=(0,p.U)(),l=(0,n.useCallback)(async()=>{try{let{data:{user:e},error:r}=await i.auth.getUser();r?(console.error("Error fetching user:",r.message),o(null),t(null)):e?(o(e),t(e.id)):(o(null),t(null))}catch(e){console.error("Failed to get auth user:",e),o(null),t(null)}finally{s(!1)}},[i.auth]);return(0,n.useEffect)(()=>{l();let{data:{subscription:e}}=i.auth.onAuthStateChange(async(e,r)=>{r?.user?(o(r.user),t(r.user.id)):(o(null),t(null)),s(!1)});return()=>{e.unsubscribe()}},[l,i.auth]),{id:e,user:r,loading:a}}(),[C,S]=(0,n.useState)(null),[N,$]=(0,n.useState)([]),[j,T]=(0,n.useState)(null),[k,E]=(0,n.useState)(!1),[P,z]=(0,n.useState)(!1),[O,D]=(0,n.useState)(!1),A=(0,n.useRef)(!1),[q,I]=(0,n.useState)(!1),[R,F]=(0,n.useState)(!1),[L,M]=(0,n.useState)(!1),[U,H]=(0,n.useState)(null),J=()=>{I(e=>!e)},G=()=>{F(e=>!e)},W=async e=>{if(z(!0),$([]),!e)return;let r=await c(e);r.error&&t("Failed to Load Configuration List",r.error),$(r.configs.sort((e,t)=>new Date(t.last_update_time).getTime()-new Date(e.last_update_time).getTime())),z(!1)},Q=async()=>{if(E(!0),!_)return;let e=await d(_);if(e.error){console.error(e.error),t("Failed to Load Configuration",e.error);return}S({backend:e.config,frontend:e.frontend_config}),E(!1)};(0,n.useEffect)(()=>{!A.current&&_&&V()},[_]),(0,n.useEffect)(()=>{"/"===b?v("home"):b.startsWith("/data")||b.startsWith("/collection")?v("data-explorer"):b.startsWith("/eval")?v("evaluation"):b.startsWith("/about/data")?v("about-data"):b.startsWith("/about")?v("about"):b.startsWith("/settings")&&v("settings")},[b]);let V=async()=>{if(!_)return;H(null);let e=await i(_);if(E(!0),e.error){console.error(e.error);let r=e.error||"Failed to initialize user configuration";H(r),t("Failed to Initialize User",r),A.current=!0,E(!1);return}W(_),S({backend:e.config,frontend:e.frontend_config}),T(e.correct_settings),E(!1),r("User Initialized"),A.current=!0},Y=async(e,o=!1)=>{E(!0),D(!0);let n=await l(_,e.backend,e.frontend,o);return n.error?(console.error(n.error),t("Failed to Save Configuration",n.error),E(!1),D(!1),!1):(n.warnings.length>0?n.warnings.forEach(e=>{s("Configuration Saved with Warning",e)}):r("Configuration Saved","Your configuration has been saved successfully."),S({backend:n.config,frontend:n.frontend_config}),W(_||""),E(!1),J(),G(),D(!1),!0)},Z=async(e,o)=>{if(!e||!o)return;E(!0);let n=await f(e,o);n.error?(console.error(n.error),t("Failed to Load Configuration",n.error)):r("Configuration Loaded","Configuration loaded successfully."),S({backend:n.config,frontend:n.frontend_config}),E(!1)},B=async e=>{if(!e)return;E(!0);let o=await u(e);if(o.error){console.error(o.error),t("Failed to Create Configuration",o.error),E(!1);return}if(r("Configuration Created","New configuration created successfully."),o.config){let e=o.config.name||"New Config",t=e,r=1;for(;N.some(e=>e.name===t);)t=`${e} ${r}`,r++;t!==e&&(o.config.name=t)}S({backend:o.config,frontend:o.frontend_config}),W(e),E(!1)},X=async(e,o,n)=>{if(!e||!o)return;E(!0);let a=await g(e,o);if(a.error)console.error(a.error),t("Failed to Delete Configuration",a.error);else if(r("Configuration Deleted","Configuration deleted successfully."),n){let t=N.find(e=>e.config_id!==o);t?Z(e,t.config_id):S(null)}W(e),E(!1),G(),J()};return(0,o.jsx)(h.Provider,{value:{mode:y,id:_,showRateLimitDialog:w,enableRateLimitDialog:()=>{x(!0)},userConfig:C,savingConfig:O,fetchCurrentConfig:Q,configIDs:N,updateConfig:Y,handleCreateConfig:B,getConfigIDs:W,handleLoadConfig:Z,handleDeleteConfig:X,loadingConfig:k,loadingConfigs:P,correctSettings:j,fetchCollectionFlag:q,initialized:A.current,triggerFetchCollection:J,triggerFetchConversation:G,fetchConversationFlag:R,updateUnsavedChanges:e=>{M(e)},unsavedChanges:L,initError:U},children:e})}},90704:(e,t,r)=>{r.d(t,{SocketProvider:()=>c,d:()=>l});var o=r(95155),n=r(12115),a=r(26939),s=r(74834),i=r(97950);let l=(0,n.createContext)({socketOnline:!1,sendQuery:async()=>!1}),c=({children:e})=>{let{setConversationStatus:t,setAllConversationStatuses:r,handleAllConversationsError:c,getAllEnabledCollections:d,handleWebsocketMessage:u}=(0,n.useContext)(s.r),{showErrorToast:f,showSuccessToast:g}=(0,n.useContext)(i.$),[m,p]=(0,n.useState)(!1),[h,y]=(0,n.useState)(),[v,b]=(0,n.useState)(!1),w=(0,n.useRef)(!1);(0,n.useEffect)(()=>{b(!0)},[]),(0,n.useEffect)(()=>{if(!w.current)return;let e=setInterval(()=>{m&&h?.readyState!==WebSocket.CLOSED&&h||(console.log("Athena not online, trying to reconnect..."),w.current=!1,b(e=>!e))},5e3);return()=>clearInterval(e)},[m,h]),(0,n.useEffect)(()=>{if(w.current)return;w.current=!0;let e=new WebSocket((0,a.sb)()+"query");e.onopen=()=>{p(!0),g("Connected to Athena")},e.onmessage=e=>{try{let t=JSON.parse(e.data);u(t)}catch(e){}},e.onerror=e=>{p(!1),y(void 0),r(""),c(),f("Connection to Athena lost")},e.onclose=()=>{p(!1),r(""),y(void 0),c(),f("Connection to Athena lost")},y(e)},[v]);let x=async(e,r,o,n,a="",s=!1,i=!1)=>{t("Thinking...",o);let l=d();return h?.send(JSON.stringify({user_id:e,query:r,query_id:n,conversation_id:o,collection_names:l,route:a,mimick:s,disable_rag:i})),Promise.resolve(!0)};return(0,o.jsx)(l.Provider,{value:{socketOnline:m,sendQuery:x},children:e})}},91337:(e,t,r)=>{r.d(t,{cn:()=>a});var o=r(29722),n=r(622);function a(...e){return(0,n.QP)((0,o.$)(e))}},91459:(e,t,r)=>{r.d(t,{Bc:()=>i,ZI:()=>d,k$:()=>c,m_:()=>l});var o=r(95155),n=r(12115),a=r(36376),s=r(91337);let i=a.Kq,l=a.bL,c=a.l9,d=n.forwardRef(({className:e,sideOffset:t=4,...r},n)=>(0,o.jsx)(a.ZL,{children:(0,o.jsx)(a.UC,{ref:n,sideOffset:t,className:(0,s.cn)("z-40 overflow-hidden rounded-md bg-background_alt px-3 py-1.5 text-xs text-primary animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));d.displayName=a.UC.displayName},97950:(e,t,r)=>{r.d(t,{$:()=>u,ToastProvider:()=>f});var o=r(95155),n=r(12115),a=r(67347),s=r(51087),i=r(74473),l=r(38323),c=r(4474);let d=({errorText:e})=>{let[t,r]=(0,n.useState)(!1),a=async t=>{t.stopPropagation();try{await navigator.clipboard.writeText(e),r(!0),setTimeout(()=>r(!1),2e3)}catch(e){console.error("Failed to copy error text:",e)}};return(0,o.jsx)("div",{className:"flex gap-2",children:(0,o.jsx)(c.$,{onClick:a,variant:"ghost",size:"sm",className:"h-8 shrink-0 px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",title:"Copy error to clipboard",children:t?(0,o.jsx)(l.G8W,{className:"h-4 w-4"}):(0,o.jsx)(i.kn0,{className:"h-4 w-4"})})})},u=(0,n.createContext)({analyzeCollection:()=>{},currentToasts:[],showErrorToast:()=>{},showSuccessToast:()=>{},showWarningToast:()=>{},finishProcessingSocket:()=>{},updateProcessingSocket:()=>{},isConfirmModalOpen:!1,confirmModalTitle:"",confirmModalDescription:"",showConfirmModal:()=>{},handleConfirmModal:()=>{},handleCancelModal:()=>{}}),f=({children:e})=>{let{toast:t}=(0,a.dj)(),[r,i]=(0,n.useState)([]),l=(0,n.useRef)(void 0),[c,f]=(0,n.useState)(!1),[g,m]=(0,n.useState)(""),[p,h]=(0,n.useState)(""),[y,v]=(0,n.useState)(null),b=e=>{let t=Math.floor((Date.now()-e)/1e3),r=Math.floor(t/60),o=t%60;return r>0?`${r}m ${o}s`:`${o}s`},w=(0,n.useCallback)((e,r)=>{let n=r||"An error occurred. Please try again.",a=`${e}: ${n}`;t({title:e,description:n,variant:"destructive",action:(0,o.jsx)(d,{errorText:a})})},[t]),x=(0,n.useCallback)((e,r)=>{t({title:e,description:r,variant:"default"})},[t]),_=(0,n.useCallback)((e,r)=>{t({title:e,description:r||"Please review this warning.",variant:"warning",action:(0,o.jsx)(s.Qg,{altText:"Dismiss",children:"Dismiss"})})},[t]),C=(0,n.useCallback)((e,t,r)=>{m(e),h(t),v(()=>r),f(!0)},[]),S=(0,n.useCallback)(()=>{y&&y(),f(!1),m(""),h(""),v(null)},[y]),N=(0,n.useCallback)(()=>{f(!1),m(""),h(""),v(null)},[]),$=(0,n.useCallback)((e,o,n)=>{r.some(t=>t.collection_name===e.name)?setTimeout(()=>{t({title:"Already analyzing "+e.name+"...",description:"Please wait for it to finish before analyzing again."})},0):setTimeout(()=>{let r=Date.now(),a=t({title:"0% - Starting analysis of "+e.name+"...",description:"Connecting to server... (0s)",progress:0,duration:1e6});i(t=>{let s=[...t,{collection_name:e.name,toast:a,progress:0,startTime:r,currentMessage:"Connecting to server..."}];if(!n||!o)return w("Error analyzing "+e.name+"...","Connection to Athena lost (Socket: "+n+") (ID: "+o+")"),i(t=>t.filter(t=>t.collection_name!==e.name)),t;{let t={user_id:o,collection_name:e.name};n.send(JSON.stringify(t))}return s})},0)},[r,t]);return(0,n.useEffect)(()=>(r.length>0?l.current=setInterval(()=>{i(e=>{let t=!1,r=e.map(e=>{if(e.progress<100){let r=b(e.startTime);e.toast.update({id:e.toast.id,title:`${Math.round(e.progress)}% - Analyzing ${e.collection_name}...`,description:`${e.currentMessage} (${r})`,progress:e.progress}),t=!0}return e});return t?r:e})},1e3):l.current&&clearInterval(l.current),()=>{l.current&&clearInterval(l.current)}),[r.length]),(0,o.jsx)(u.Provider,{value:{analyzeCollection:$,currentToasts:r,showErrorToast:w,showSuccessToast:x,showWarningToast:_,finishProcessingSocket:(e,t)=>{i(r=>{let n=r.find(t=>t.collection_name===e);if(!n)return r;let a=b(n.startTime);if(t){let e=`${t} (Total time: ${a})`,r=`Error analyzing ${n.collection_name}: ${e}`;n.toast.update({id:n.toast.id,title:`100% - Error analyzing ${n.collection_name}...`,variant:"destructive",description:e,progress:100,action:(0,o.jsx)(d,{errorText:r})})}else n.toast.update({id:n.toast.id,title:"100% - Done!",description:`Collection analyzed successfully (Total time: ${a})`,progress:100,action:(0,o.jsx)(s.Qg,{altText:"Close",onClick:()=>n.toast.dismiss(),children:"Close"})});return r.filter(t=>t.collection_name!==e)})},updateProcessingSocket:(e,t,r)=>{i(o=>{let n=o.find(t=>t.collection_name===e);if(!n)return o;let a=Number((100*t).toFixed(2)),s=b(n.startTime);return n.toast.update({id:n.toast.id,title:`${Math.round(a)}% - Analyzing ${n.collection_name}...`,description:`${r} (${s})`,progress:a}),o.map(t=>t.collection_name===e?{...t,progress:a,currentMessage:r}:t)})},isConfirmModalOpen:c,confirmModalTitle:g,confirmModalDescription:p,showConfirmModal:C,handleConfirmModal:S,handleCancelModal:N},children:e})}},99151:(e,t,r)=>{r.d(t,{EvaluationProvider:()=>l,k:()=>i});var o=r(95155),n=r(12115),a=r(73321),s=r(36992);let i=(0,n.createContext)({evalPage:null,changeEvalPage:()=>{},showFeedbackNotification:!0,disableFeedbackNotification:()=>{}}),l=({children:e})=>{let{changePage:t}=(0,n.useContext)(s.z),r=(0,a.useSearchParams)(),l=(0,a.usePathname)(),[c,d]=(0,n.useState)(null),[u,f]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{"/eval"===l?d(null):"/eval/feedback"===l&&d("feedback")},[r,l]),(0,o.jsx)(i.Provider,{value:{evalPage:c,changeEvalPage:e=>{null===e?t("eval",{},!0):t("eval",{page:e},!0)},showFeedbackNotification:u,disableFeedbackNotification:()=>{f(!1)}},children:e})}}}]);